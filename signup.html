<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Sign Up - Calorie Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#000000",
                        "on-primary": "#ffffff",
                        "secondary": "#f3f4f6",
                        "background-light": "#f2f4f7",
                        "background-dark": "#0a0a0a",
                        "surface-light": "#ffffff",
                        "surface-dark": "#171717",
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "0.75rem", "xl": "1rem", "2xl": "1.5rem", "3xl": "2rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark font-display text-[#111b0d] dark:text-white transition-colors duration-200">
    <div
        class="relative flex h-screen w-full flex-col overflow-hidden max-w-md mx-auto shadow-2xl bg-background-light dark:bg-background-dark">
        <!-- Top App Bar -->
        <div class="flex items-center p-4 pb-2 justify-between z-10 shrink-0">
            <a href="index.html" aria-label="Go back"
                class="flex size-12 shrink-0 items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
                <span class="material-symbols-outlined text-[#111b0d] dark:text-white"
                    style="font-size: 24px;">arrow_back_ios_new</span>
            </a>
        </div>

        <!-- Scrollable Content Area -->
        <div class="flex-1 overflow-y-auto no-scrollbar px-6 pb-6">
            <div class="pt-2 pb-6">
                <h1
                    class="text-[#111b0d] dark:text-white tracking-tight text-[32px] font-extrabold leading-tight text-left">
                    Create your account
                </h1>
                <p class="text-[#111b0d]/70 dark:text-white/70 text-base font-medium leading-normal pt-2">
                    Start tracking your calories today.
                </p>
            </div>

            <!-- Form Fields -->
            <form id="signupForm" class="flex flex-col gap-5" onsubmit="handleSignup(event)">
                <!-- Full Name -->
                <div class="flex flex-col gap-2">
                    <label class="text-[#111b0d] dark:text-white text-base font-medium leading-normal ml-1"
                        for="fullname">Full Name</label>
                    <input required
                        class="form-input flex w-full resize-none overflow-hidden rounded-2xl text-[#111b0d] dark:text-white border-none ring-1 ring-neutral-200 bg-surface-light dark:bg-surface-dark focus:ring-2 focus:ring-primary h-14 placeholder:text-neutral-400 px-4 text-base font-normal transition-all outline-none"
                        id="fullname" placeholder="John Doe" type="text" />
                </div>

                <!-- Email -->
                <div class="flex flex-col gap-2">
                    <label class="text-[#111b0d] dark:text-white text-base font-medium leading-normal ml-1"
                        for="email">Email Address</label>
                    <input required
                        class="form-input flex w-full resize-none overflow-hidden rounded-2xl text-[#111b0d] dark:text-white border-none ring-1 ring-neutral-200 bg-surface-light dark:bg-surface-dark focus:ring-2 focus:ring-primary h-14 placeholder:text-neutral-400 px-4 text-base font-normal transition-all outline-none"
                        id="email" placeholder="hello@example.com" type="email" />
                </div>

                <!-- Password -->
                <div class="flex flex-col gap-2">
                    <label class="text-[#111b0d] dark:text-white text-base font-medium leading-normal ml-1"
                        for="password">Password</label>
                    <div class="relative flex items-center">
                        <input required minlength="8"
                            class="form-input flex w-full resize-none overflow-hidden rounded-2xl text-[#111b0d] dark:text-white border-none ring-1 ring-neutral-200 bg-surface-light dark:bg-surface-dark focus:ring-2 focus:ring-primary h-14 placeholder:text-neutral-400 pl-4 pr-12 text-base font-normal transition-all outline-none"
                            id="password" placeholder="••••••••" type="password" />
                        <button
                            class="absolute right-4 flex items-center justify-center text-neutral-400 hover:text-primary transition-colors"
                            type="button"
                            onclick="const p = document.getElementById('password'); p.type = p.type === 'password' ? 'text' : 'password'">
                            <span class="material-symbols-outlined" style="font-size: 20px;">visibility_off</span>
                        </button>
                    </div>
                    <p class="text-xs text-[#111b0d]/50 dark:text-white/50 px-1">Must be at least 8 characters</p>
                </div>

                <div id="errorMessage" class="hidden text-red-500 text-sm text-center font-bold"></div>

                <!-- Sign Up Button -->
                <div class="pt-4">
                    <button type="submit"
                        class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-full h-14 bg-primary text-on-primary text-base font-bold leading-normal tracking-[0.015em] hover:opacity-90 active:scale-[0.98] transition-all shadow-lg">
                        <span class="truncate">Sign Up</span>
                    </button>
                </div>

                <div class="relative flex items-center py-2">
                    <div class="flex-grow border-t border-neutral-200 dark:border-neutral-700"></div>
                    <span class="flex-shrink-0 mx-4 text-gray-400 dark:text-gray-500 text-sm">Or continue with</span>
                    <div class="flex-grow border-t border-neutral-200 dark:border-neutral-700"></div>
                </div>

                <p class="text-center text-xs text-[#111b0d]/50 dark:text-white/50 pt-2 leading-relaxed">
                    By signing up, you agree to our
                    <a class="font-semibold text-[#111b0d] dark:text-white underline decoration-primary/50 hover:decoration-primary decoration-2 underline-offset-2 transition-all"
                        href="#">Terms of Service</a>
                    and
                    <a class="font-semibold text-[#111b0d] dark:text-white underline decoration-primary/50 hover:decoration-primary decoration-2 underline-offset-2 transition-all"
                        href="#">Privacy Policy</a>.
                </p>
            </form>
        </div>

        <!-- Bottom Link -->
        <div class="p-6 pt-0 mt-auto shrink-0 text-center">
            <p class="text-[#111b0d] dark:text-white text-base font-medium">
                Already have an account?
                <a class="text-primary font-bold hover:brightness-110 transition-colors" href="index.html">Log In</a>
            </p>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        // Check if already logged in
        Auth.redirectIfAuthenticated();

        function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const fullname = document.getElementById('fullname').value; // We could store this too in profile logic
            const errorMsg = document.getElementById('errorMessage');

            const result = Auth.signup(email, password);

            if (result.success) {
                // Update profile name
                const users = JSON.parse(localStorage.getItem('app_users'));
                const currentUser = users.find(u => u.email === email);
                if (currentUser) {
                    currentUser.profile.name = fullname;
                    localStorage.setItem('app_users', JSON.stringify(users));

                    // Update session
                    const session = JSON.parse(localStorage.getItem('app_session'));
                    session.name = fullname;
                    localStorage.setItem('app_session', JSON.stringify(session));
                }

                window.location.href = 'dashboard.html';
            } else {
                errorMsg.textContent = result.message;
                errorMsg.classList.remove('hidden');
            }
        }
    </script>
</body>

</html>